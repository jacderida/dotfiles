#!/usr/bin/env bash

function init_directories
{
    if [ ! -d "$HOME/.vim/colors" ]; then
        mkdir -p ~/.vim/colors
    fi
    if [ ! -d "$HOME/.vim/syntax" ]; then
        mkdir -p ~/.vim/syntax
    fi
    if [ ! -d "$HOME/.vim/autoload" ]; then
        mkdir -p ~/.vim/autoload
    fi
    if [ ! -d "$HOME/.vim/bundle" ]; then
        mkdir -p ~/.vim/bundle
    fi
    if [ ! -d "$HOME/.vim/backup" ]; then
        mkdir -p ~/.vim/backup
    fi
    if [ ! -d "$HOME/.vim/tmp" ]; then
        mkdir -p ~/.vim/tmp
    fi
}

function install_manual_plugins
{
    for plugin in `find ./vim/plugins -maxdepth 1 -type d`
    do
        echo -e "${green}Installing manual plugin $plugin ${nc}"
        cp -r $plugin/* ~/.vim
    done
}

function install_vundle_plugin
{
    if [ ! -d "$HOME/.vim/bundle/vundle" ]
    then
        git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle
    else
        echo -e "${green}Already installed vundle${nc}"
    fi
}

function install_json_plugin
{
    if [ ! -d "$HOME/.vim/bundle/vim-json" ]
    then
        git clone https://github.com/elzr/vim-json.git ~/.vim/bundle/vim-json
    else
        echo -e "${green}Already installed vim-json${nc}"
    fi
}

function install_rails_plugin
{
    if [ ! -d "$HOME/.vim/bundle/vim-rails" ]
    then
        git clone https://github.com/tpope/vim-rails.git ~/.vim/bundle/vim-rails
    else
        echo -e "${green}Already installed vim-rails${nc}"
    fi
}

function install_bundler_plugin
{
    if [ ! -d "$HOME/.vim/bundle/vim-bundler" ]
    then
        git clone https://github.com/tpope/vim-bundler.git ~/.vim/bundle/vim-bundler
    else
        echo -e "${green}Already installed vim-bundler${nc}"
    fi
}

function install_command_t_plugin
{
    if [ ! -d "$HOME/.vim/bundle/command-t" ]
    then
        echo -e "${green}Installing command-t plugin${nc}"
        git clone https://github.com/wincent/Command-T.git ~/.vim/bundle/command-t
        present_directory=`pwd`
        cd ~/.vim/bundle/command-t/ruby/command-t
        if [[ $(uname -s) != CYGWIN_NT-* ]]; then
            [[ -s "$HOME/.rvm/scripts/rvm" ]] && source "$HOME/.rvm/scripts/rvm"
            rvm use 1.8.7
        fi
        ruby extconf.rb
        if [[ $(uname -s) = CYGWIN_NT-* ]]; then
            # On Cygwin, replace
            # CFLAGS += -Wall -Wextra -Wno-unused-parameter
            # with
            # CFLAGS += -Wextra -Wno-unused-parameter
            # This switches off all warnings as errors. For some reason, on Cygwin, there's a weird 64 bit integer
            # warning that prevents successful compilation.
            sed -i 's/^CFLAGS +=.*/CFLAGS += -Wextra -Wno-unused-parameter/g' Makefile
        fi
        make
        cd $present_directory
    else
        echo -e "${green}Already installed command-t${nc}"
    fi
}

function install_nerdtree_plugin
{
    if [ ! -d "$HOME/.vim/bundle/nerdtree" ]
    then
        echo -e "${green}Installing nerdtree plugin${nc}"
        git clone https://github.com/scrooloose/nerdtree.git ~/.vim/bundle/nerdtree
    else
        echo -e "${green}Already installed nerdtree${nc}"
    fi
}

function install_nerdcommenter_plugin
{
    if [ ! -d "$HOME/.vim/bundle/nerdcommenter" ]
    then
        echo -e "${green}Installing nerdcommenter plugin${nc}"
        git clone https://github.com/scrooloose/nerdcommenter.git ~/.vim/bundle/nerdcommenter
    else
        echo -e "${green}Already installed nerdcommenter${nc}"
    fi
}

function install_syntastic_plugin
{
    if [ ! -d "$HOME/.vim/bundle/syntastic" ]
    then
        echo -e "${green}Installing syntastic plugin${nc}"
        git clone https://github.com/scrooloose/syntastic.git ~/.vim/bundle/syntastic
    else
        echo -e "${green}Already installed syntastic${nc}"
    fi
}

function install_endwise_plugin
{
    if [ ! -d "$HOME/.vim/bundle/vim-endwise" ]
    then
        echo -e "${green}Installing vim-endwise plugin${nc}"
        git clone https://github.com/tpope/vim-endwise.git ~/.vim/bundle/vim-endwise
    else
        echo -e "${green}Already installed vim-endwise${nc}"
    fi
}

function install_fugitive_plugin
{
    if [ ! -d "$HOME/.vim/bundle/vim-fugitive" ]
    then
        echo -e "${green}Installing vim-fugitive plugin${nc}"
        git clone https://github.com/tpope/vim-fugitive.git ~/.vim/bundle/vim-fugitive
    else
        echo -e "${green}Already installed vim-fugitive${nc}"
    fi
}

function install_asynccommand_plugin
{
    if [ ! -d "$HOME/.vim/bundle/AsyncCommand" ]
    then
        echo -e "${green}Installing AsyncCommand plugin${nc}"
        git clone https://github.com/pydave/AsyncCommand.git ~/.vim/bundle/AsyncCommand
    else
        echo -e "${green}Already installed AsyncCommand${nc}"
    fi
}

function install_tabular_plugin
{
    if [ ! -d "$HOME/.vim/bundle/tabular" ]
    then
        echo -e "${green}Installing tabular plugin${nc}"
        git clone https://github.com/godlygeek/tabular.git ~/.vim/bundle/tabular
    else
        echo -e "${green}Already installed tabular${nc}"
    fi
}

function install_vim-puppet_plugin
{
    if [ ! -d "$HOME/.vim/bundle/vim-puppet" ]
    then
        echo -e "${green}Installing vim-puppet plugin${nc}"
        git clone https://github.com/rodjek/vim-puppet.git ~/.vim/bundle/vim-puppet
    else
        echo -e "${green}Already installed vim-puppet${nc}"
    fi
}

function install_vim-msbuild_plugin
{
    if [ ! -d "$HOME/.vim/bundle/vim-msbuild" ]
    then
        echo -e "${green}Installing vim-msbuild plugin${nc}"
        git clone https://github.com/heaths/vim-msbuild.git ~/.vim/bundle/vim-msbuild
    else
        echo -e "${green}Already installed vim-msbuild${nc}"
    fi
}

function install_vjde_plugin
{
    if [ ! -d "$HOME/.vim/bundle/vjde" ]
    then
        echo -e "${green}Installing vjde plugin${nc}"
        git clone https://github.com/cespare/vjde.git ~/.vim/bundle/vjde
    else
        echo -e "${green}Already installed vjde${nc}"
    fi
}

function install_airline
{
    if [ ! -d "$HOME/.vim/bundle/vim-airline" ]
    then
        echo -e "${green}Installing airline plugin${nc}"
        git clone https://github.com/bling/vim-airline.git ~/.vim/bundle/vim-airline
    else
        echo -e "${green}Already installed airline${nc}"
    fi
}

function install_gitgutter
{
    if [ ! -d "$HOME/.vim/bundle/vim-gitgutter" ]
    then
        echo -e "${green}Installing gitgutter plugin${nc}"
        git clone https://github.com/airblade/vim-gitgutter.git ~/.vim/bundle/vim-gitgutter
    else
        echo -e "${green}Already installed gitgutter${nc}"
    fi
}

function install_base16
{
    if [ ! -d "$HOME/.vim/bundle/base16-vim" ]
    then
        echo -e "${green}Installing base16 plugin${nc}"
        git clone https://github.com/chriskempson/base16-vim.git ~/.vim/bundle/base16-vim
    else
        echo -e "${green}Already installed base16${nc}"
    fi
}

function install_plugins
{
    install_manual_plugins
    install_vundle_plugin
    install_json_plugin
    install_rails_plugin
    install_bundler_plugin
    install_command_t_plugin
    install_nerdtree_plugin
    install_nerdcommenter_plugin
    install_syntastic_plugin
    install_endwise_plugin
    install_fugitive_plugin
    install_tabular_plugin
    install_vim-puppet_plugin
    install_vim-msbuild_plugin
    install_airline
    install_gitgutter
    install_base16
}

function install_files
{
    echo -e "${green}Removing .vimrc and linking from dotfiles${nc}"
    rm -f ~/.vimrc
    ln -f ./vim/.vimrc ~/.vimrc
    echo -e "${green}Installing vim colours from dotfiles${nc}"
    cp ./vim/colors/*.* ~/.vim/colors
    echo -e "${green}Installing pathogen from dotfiles${nc}"
    cp ./vim/pathogen.vim ~/.vim/autoload
    cp ./vim/sh.vim ~/.vim/syntax
}

init_directories
install_plugins
install_files
