#!/usr/bin/env bash

function init_directories()
{
    [[ ! -d "$HOME/.vim/colors" ]] && mkdir -p ~/.vim/colors
    [[ ! -d "$HOME/.vim/syntax" ]] && mkdir -p ~/.vim/syntax
    [[ ! -d "$HOME/.vim/autoload" ]] && mkdir -p ~/.vim/autoload
    [[ ! -d "$HOME/.vim/bundle" ]] && mkdir -p ~/.vim/bundle
    [[ ! -d "$HOME/.vim/backup" ]] && mkdir -p ~/.vim/backup
    [[ ! -d "$HOME/.vim/tmp" ]] && mkdir -p ~/.vim/tmp
    echo "Initialised Vim directories"
}

function install_vundle_plugin()
{
    if [ ! -d "$HOME/.vim/bundle/Vundle.vim" ]
    then
        git clone https://github.com/gmarik/Vundle.vim.git ~/.vim/bundle/Vundle.vim
    else
        echo -e "${green}Already installed vundle${nc}"
    fi
}

function install_cmake()
{
    case $(uname -a) in
        *Ubuntu*)
            sudo apt-get install -y python-dev
            sudo apt-get install -y cmake
            ;;
        *)
            echo "Setting up dependencies for YouCompleteMe: Unsupported OS encountered. Update install_cmake to support the current OS."
            exit 1
    esac
}

function setup_you_complete_me()
{
    if [ ! -e "$HOME/.vim/you_complete_me_is_setup" ]; then
        install_cmake
        local you_complete_me_path=$HOME/.vim/bundle/YouCompleteMe
        local present_path=$(pwd)
        cd $you_complete_me_path
        ./install.sh --clang-completer --omnisharp-completer --gocode-completer
        touch $HOME/.vim/you_complete_me_is_setup
        cd $present_path
    fi
}

function install_manual_plugins()
{
    for plugin in `find ./vim/plugins -maxdepth 1 -type d`
    do
        echo -e "${green}Installing manual plugin $plugin ${nc}"
        cp -r $plugin/* ~/.vim
    done
}

function install_bundler_plugin()
{
    if [ ! -d "$HOME/.vim/bundle/vim-bundler" ]
    then
        git clone https://github.com/tpope/vim-bundler.git ~/.vim/bundle/vim-bundler
    else
        echo -e "${green}Already installed vim-bundler${nc}"
    fi
}

function install_plugins()
{
    install_manual_plugins
    install_vundle_plugin
    install_bundler_plugin
}

function install_files()
{
    echo -e "${green}Removing .vimrc and linking from dotfiles${nc}"
    rm -f ~/.vimrc
    ln -f ./vim/.vimrc ~/.vimrc
    echo -e "${green}Removing .gvimrc and linking from dotfiles${nc}"
    rm -f ~/.gvimrc
    ln -f ./vim/.gvimrc ~/.gvimrc
    echo -e "${green}Installing vim colours from dotfiles${nc}"
    cp ./vim/colors/*.* ~/.vim/colors
    echo -e "${green}Installing pathogen from dotfiles${nc}"
    cp ./vim/pathogen.vim ~/.vim/autoload
    cp ./vim/sh.vim ~/.vim/syntax
}

init_directories
install_files
install_vundle_plugin
vim +PluginInstall +qall
setup_you_complete_me
install_plugins
